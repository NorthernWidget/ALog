<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ALog: ALog</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ALog_logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ALog
   &#160;<span id="projectnumber">v0.3.2</span>
   </div>
   <div id="projectbrief">Open-source Arduino-based data logger library, designed for field science</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classALog.html">ALog</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b><a class="el" href="classALog.html">ALog</a></b> library is a toolkit for open-source data logging designed for the Arduino-based <a class="el" href="classALog.html">ALog</a> (<a href="http://northernwidget.com/alog/">http://northernwidget.com/alog/</a>), but that will also work with any standard Arduino-Uno or -Mega-based system that is outfitted with a SD card and a DS3231 real-time clock.</p>
<p>This library is optimized to:</p>
<ol type="1">
<li>handle all of the basic file, system, and power management behind-the-scenes, including power consumption reduction to minimal levels through the use of the sleep functions</li>
<li>include and expose sensor functions as single-line calls, with a template for the addition of new sensors.</li>
</ol>
<p>If you use the <a class="el" href="classALog.html">ALog</a> library (and/or data logger) in a publication, please cite:</p>
<p>**Wickert, A. D. (2014), [The <a class="el" href="classALog.html">ALog</a>: Inexpensive, Open-Source, Automated Data Collection in the Field](<a href="http://onlinelibrary.wiley.com/wol1/doi/10.1890/0012-9623-95.2.68/full">http://onlinelibrary.wiley.com/wol1/doi/10.1890/0012-9623-95.2.68/full</a>), <em>Bull. Ecol. Soc. Am.</em>, <em>95</em>(2), 68–78, &lt;doi:10.1890/0012-9623-95.2.68.**&gt;</p>
<p>In addition to the README.md at <a href="https://github.com/NorthernWidget/ALog">https://github.com/NorthernWidget/ALog</a>, documentation is available as a combination of the information here and an index of logger functions in both <a href="http://northernwidget.github.io/ALog">[HTML]</a> and <a href="http://northernwidget.github.io/ALog/ALogReferenceManual.pdf">[PDF]</a> format. </p><hr/>
<h1>Quick reference </h1>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ProgrammingCard.png" alt="Programming reference
card." title="Programming reference card."/>
</div>
<p>\ <hr/>
<h1>Quick-start guide </h1>
<p><em><b>No-frills, no-pictures, as quick as possible. All the same material is covered in more detail in the</b></em> **"Complete guide: from the basics
onward,"** <em><b>below; look there if you get stuck</b></em></p>
<ol type="1">
<li>Download and install the Arduino IDE from <a href="https://www.arduino.cc/en/Main/Software">https://www.arduino.cc/en/Main/Software</a></li>
<li>Install all required software libraries: start the IDE, go to "Sketch --&amp;gt; Include Library --&amp;gt; Manage Libraries...", and search for and install the following:<ol type="a">
<li>The <a class="el" href="classALog.html">ALog</a> library; you can find this more easily by typing "Northern Widget" into the search box</li>
<li>The DS3231 library (for the real-time clock); this can also be found by typing "Northern Widget"</li>
<li>The SdFat library (for the SD card); simply typing "sdfat" into the search box will do.</li>
<li>The BMP180 library from SparkFun electronics (<b>key difference:</b> This must be downloaded and installed separately via a copy/paste into your Arduino/libraries folder; we are looking into options to avoid this necessity)</li>
</ol>
</li>
<li>Add support for the <a class="el" href="classALog.html">ALog</a> boards. (Skip this step if you're using a non-ALog Arduino.) Detailed instructions, available from <a href="https://github.com/NorthernWidget/Arduino_Boards">https://github.com/NorthernWidget/Arduino_Boards</a>, are also included below in the Complete Guide.<ol type="a">
<li>Go to File &ndash;&gt; Preferences (Arduino &ndash;&gt; Preferences on Mac) and paste this URL into the "Additional Boards Manager
        URLs" entry zone, in the lower right: <a href="https://raw.githubusercontent.com/NorthernWidget/Arduino_Boards/master/package_NorthernWidget_index.json">https://raw.githubusercontent.com/NorthernWidget/Arduino_Boards/master/package_NorthernWidget_index.json</a></li>
<li>Go to Tools &ndash;&gt; Boards &ndash;&gt; Boards Manager; type in "Northern Widget" and install these boards definitions.</li>
</ol>
</li>
<li>Choose the board that you will be using. Go to tools &ndash;&gt; board, and then (most likely) &ndash;&gt; <a class="el" href="classALog.html">ALog</a> BottleLogger v2.</li>
<li>Slide an SD card into the receptacle on the <a class="el" href="classALog.html">ALog</a> BottleLogger.</li>
<li>Using a USB cable, plug your <a class="el" href="classALog.html">ALog</a> data logger (or compatible Arduino device) into the computer</li>
<li>Go to File (Arduino on Mac) &ndash;&gt; Examples &ndash;&gt; <a class="el" href="classALog.html">ALog</a> &ndash;&gt; BasicStart. Click on it to load the file.</li>
<li>Upload the code to the logger: click on the "upload" button (right arrow) or press CTRL+u (command+u on Mac)</li>
<li>Look at the logger. You should see the blue and yellow lights flashing to show that it is communicating with the computer.</li>
<li>Open the serial monitor (top right button) and set the baud rate to 38400 bps.</li>
<li>See if the logger works; if it does, you are ready to start adding commands to read sensors.<ol type="a">
<li>If it doesn't, please check your progress through these steps, look through the rest of this guide, and if you really can't figure it out, email us at <a href="#" onclick="location.href='mai'+'lto:'+'inf'+'o@'+'nor'+'th'+'ern'+'wi'+'dge'+'t.'+'com'; return false;">info@<span style="display: none;">.nosp@m.</span>nort<span style="display: none;">.nosp@m.</span>hernw<span style="display: none;">.nosp@m.</span>idge<span style="display: none;">.nosp@m.</span>t.com</a>.</li>
<li>Use the "RESET" button if at any point you need to restart the program</li>
<li>Use the "LOG" (or "LOG NOW") button to instantly take a reading, even if the logger would not otherwise be recording anything at that time <hr/>
</li>
</ol>
</li>
</ol>
<h1>Basic Reference </h1>
<p><em><b>For those already familiar with Arduino and with all of the required software already installed</b></em></p>
<h2>Using the <a class="el" href="classALog.html">ALog</a> library </h2>
<h3>Structure of an Arduino sketch with the <a class="el" href="classALog.html">ALog</a> library</h3>
<p>The following code is an Ardiuno "sketch" that includes the Alog library. It works whether you are using an:</p>
<ul>
<li><a class="el" href="classALog.html">ALog</a> data logger</li>
<li>Arduino Uno (with <a class="el" href="classALog.html">ALog</a> shield or equivalent clock and SD card)</li>
<li>Arduino Mega (with <a class="el" href="classALog.html">ALog</a> shield or equivalent clock and SD card)</li>
</ul>
<p><em>Support for ARM-series Arduino boards is currently under development.</em></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ALog_8h.html">ALog.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="classALog.html">ALog</a> alog;</div><div class="line"></div><div class="line"><span class="comment">// Note: Serial baud rate is set to 38400 bps</span></div><div class="line"></div><div class="line"><span class="comment">// USER-ENTERED VARIABLES //</span></div><div class="line"><span class="comment"></span><span class="keywordtype">char</span>* dataLoggerName = <span class="stringliteral">&quot;T01&quot;</span>; <span class="comment">// Name of logger; displayed in Serial communications</span></div><div class="line"><span class="keywordtype">char</span>* fileName = <span class="stringliteral">&quot;T01.txt&quot;</span>; <span class="comment">// Name of file for logged data: 8.3 format (e.g,</span></div><div class="line">                            <span class="comment">// ABCDEFGH.TXT); &lt;= 8 chars before &quot;.txt&quot; is OK</span></div><div class="line"></div><div class="line"><span class="comment">//Setup logging interval here, may set up more than one variable.</span></div><div class="line"><span class="comment">//Minimum interval = 1 sec, maximum interval is 23 hours, 59 minutes, 59 seconds</span></div><div class="line"><span class="comment">//0 for all means that the logger will not sleep</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Seconds = 10; <span class="comment">//Valid range is 0-59 seconds</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Minutes = 0; <span class="comment">//Valid range is 0-59 minutes</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Hours = 0; <span class="comment">//Valid range is 0-23 hours</span></div><div class="line"><span class="comment">// external_interrupt is true for a tipping bucket rain gauge</span></div><div class="line"><span class="keywordtype">bool</span> external_interrupt = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup(){</div><div class="line">  alog.<a class="code" href="classALog.html#a39a065992ef2c51a992ddc0fe0f0c0e4">initialize</a>(dataLoggerName, fileName,</div><div class="line">    Log_Interval_Hours, Log_Interval_Minutes, Log_Interval_Seconds,</div><div class="line">    external_interrupt);</div><div class="line"></div><div class="line">  <span class="comment">// If you are using a standard Arduino board (i.e. not a full ALog data logger)</span></div><div class="line">  <span class="comment">// and are not using the Arduino shield, you will have to set the proper pins for</span></div><div class="line">  <span class="comment">// the indicator LED (defaults to 9) and the SD card and RTC power (default to -1</span></div><div class="line">  <span class="comment">// to be inactive in the case of constant power supply; set these to the same</span></div><div class="line">  <span class="comment">// value if there is just one switch for both of these).</span></div><div class="line">  <span class="comment">// Replace &quot;_pin&quot; with your desired pin number, and uncomment the relevant line(s).</span></div><div class="line">  <span class="comment">// set_LEDpin(_pin);</span></div><div class="line">  <span class="comment">// set_SDpowerPin(_pin);</span></div><div class="line">  <span class="comment">// set_RTCpowerPin(_pin);</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#a6cb64bdadb4df047d14632614ffaac13">setupLogger</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop(){</div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#ab84c0dd0f4de44aa1232a86b8006ae8c">goToSleep_if_needed</a>(); <span class="comment">// Send logger to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#aa8a242bb8886969dacd615e47bbd4537">startLogging</a>(); <span class="comment">// Power up all systems, check WDT, reset alarms,</span></div><div class="line">                       <span class="comment">// and open data file(s) in write mode</span></div><div class="line"></div><div class="line">  <span class="comment">// ************ DO NOT EDIT ABOVE THIS LINE ************</span></div><div class="line"></div><div class="line">  <span class="comment">// READ SENSORS; GATHER/PROCESS DATA: EDIT THIS PART //</span></div><div class="line"><span class="comment"></span></div><div class="line">  alog.<a class="code" href="classALog.html#a4caaaa0172dc3ef82dba5934ae1c5f6d">sensorPowerOn</a>();</div><div class="line"></div><div class="line">  <span class="comment">// Turn on external power (3.3V and 5V in the case of the ALog BottleLogger)</span></div><div class="line">  <span class="comment">// for sensors and any other devices.</span></div><div class="line">  <span class="comment">// Place commands for all sensors that require this between</span></div><div class="line">  <span class="comment">// SensorPowerOn() and SensorPowerOff().</span></div><div class="line">  <span class="comment">// If you have no sensors that require power, you should comment out the</span></div><div class="line">  <span class="comment">// SensorPowerOn() and SensorPowerOff() commands.</span></div><div class="line"></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line">  <span class="comment">// INSERT COMMANDS TO READ SENSORS THAT REQUIRE ALOG-SUPPLIED POWER HERE! //</span></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#ae6b39bc05a8e82c44ee1588bc0cd50dc">sensorPowerOff</a>();</div><div class="line"></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line">  <span class="comment">// INSERT COMMANDS TO READ SENSORS THAT DO NOT REQUIRE ALOG-SUPPLIED POWER HERE! //</span></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// NOTE: THE BUFFER SIZE IS 512 BYTES;</span></div><div class="line">  <span class="comment">// run &quot;alog.bufferWrite()&quot; between your commands in this section</span></div><div class="line">  <span class="comment">// if you think you are approaching this limit.</span></div><div class="line">  <span class="comment">// Otherwise, the buffer will overflow and I&#39;m not sure what will happen!</span></div><div class="line">  <span class="comment">// alog.bufferWrite()</span></div><div class="line"></div><div class="line">  <span class="comment">// ************ DO NOT EDIT BELOW THIS LINE ************</span></div><div class="line"></div><div class="line">  <span class="comment">// Wrap up files, turn off SD card, and go back to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#a3919a4ae72a0b6ac7dea25a5a1e8a6d0">endLogging</a>();</div><div class="line"></div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line">}</div></div><!-- fragment --><h3>Sensor commands</h3>
<p>Sensor commands are defined in detail in the extended help, available below (PDF version) and at <a href="http://northernwidget.github.io/ALog/classALog.html">http://northernwidget.github.io/ALog/classALog.html</a>.</p>
<p>In short, they look like:</p>
<div class="fragment"><div class="line">alog.sensorName(parameter1, parameter2, parameter3)</div></div><!-- fragment --><p>where these parameters can be the pin numbers to which the sensors are attached, sensor-specific electrical characteristics (e.g., resistance), calibration values, and quantities that affect how the sensor behaves during its operation.</p>
<p>One example, for a thermistor (a temperature-sensitive resistor), is:</p>
<div class="fragment"><div class="line">logger.thermistorB(10000, 3380, 10000, 25, 0);</div></div><!-- fragment --><p>Where the parameters are, in order:</p>
<ul>
<li><b>R0</b>: Known resistance at given known temperature (here 10,000 ohms)</li>
<li><b>B</b>: The parameter governing the curvature of the resistance-to-temperature calibration curve (here 3380 K)</li>
<li><b>Rref</b>: The resistance of the known resistor (here also 10,000 Ω, to optimize measurement sensitivity at 10 kΩ)</li>
<li><b>T0degC</b>: The temperature [in Celsius] at which the known resistance equals <b>R0</b> (here 25°C)</li>
<li><b>thermPin</b>: The analog pin number to be read</li>
</ul>
<p>This thermistor example is reiterated and expanded upon in the "Guide
for first-time users: from the basics onward", below.</p>
<h2>Adding support for new sensors </h2>
<p>Printed below is the template function designed to guide users about how to add support for additional sensors. You may also look at <a class="el" href="ALog_8cpp.html">ALog.cpp</a> and <a class="el" href="ALog_8h.html">ALog.h</a> for our current examples, and feel free to contact us (<a href="#" onclick="location.href='mai'+'lto:'+'inf'+'o@'+'nor'+'th'+'ern'+'wi'+'dge'+'t.'+'com'; return false;">info@<span style="display: none;">.nosp@m.</span>nort<span style="display: none;">.nosp@m.</span>hernw<span style="display: none;">.nosp@m.</span>idge<span style="display: none;">.nosp@m.</span>t.com</a>) if you have questions about how to properly incorporate new sensors.</p>
<p>If you do add your sensor to our library or make an improvement, <b>we would really appreciate it if you would contact us about including the changes you've made</b>. We have designed the <a class="el" href="classALog.html">ALog</a> library as a resource for the community, and the more of us who make it better, the bigger and better open-source field instrumentation grows!</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classALog.html#a2a890b3212d458b4a22280b99d5a0c10">ALog::_sensor_function_template</a>(uint8_t pin, <span class="keywordtype">float</span> param1, <span class="keywordtype">float</span> param2,</div><div class="line">           uint8_t ADC_bits, <span class="keywordtype">bool</span> flag){</div></div><!-- fragment --><ul>
<li>alog.Example(A2, 1021.3, 15.2, True);</li>
<li>```</li>
<li>*/</li>
</ul>
<p>float Vout_normalized_analog_example = analogReadOversample(pin, \ ADC_bits) / 1023.;</p>
<p>float Some_variable = Vout_normalized_analog_example * param1 / param2; if (flag){ Some_variable /= 2.; }</p>
<p>/////////////// // SAVE DATA // ///////////////</p>
<p>if (first_log_after_booting_up){ headerfile.print("Some variable [units]"); headerfile.print(","); headerfile.sync(); }</p>
<p>// SD write datafile.print(Some_variable); datafile.print(F(","));</p>
<p>// Echo to serial Serial.print(Some_variable); Serial.print(F(","));</p>
<p>} ```</p>
<h2>LED </h2>
<p><em><b>(This is identical to "LED messages", below in the full guide)</b></em></p>
<p>These messages are flashed on the large red LED. Those in bold are those that you may see most commonly.</p>
<ul>
<li>Syncopated: <b>daaaa-da-daaaa-da-daaaa-da</b>: Clock has reset to the year 2000! Please set the clock.</li>
<li><b>LONG-short-short</b>: All is good! Starting to log.</li>
<li>5 quick flashes: Missed first alarm; caught by backup alarm. Rebooting logger.</li>
<li><b>20 quick flashes</b>: SD card failed, or (more likely) is not present. This also happens if it is not seated properly; reseat the card and try again.</li>
<li>50 quick flashes: you have tried to reassign a pin critical to the <a class="el" href="classALog.html">ALog</a> to another function; this will most likely break the system. Check your code and re-upload.</li>
<li>100 quick flashes: your Arduino model is not recognized by the <a class="el" href="classALog.html">ALog</a> library!</li>
</ul>
<h2>Buttons </h2>
<p><em><b>(This is identical to "Buttons: RESET and LOG", below in the full guide)</b></em></p>
<p>There are two buttons on the <a class="el" href="classALog.html">ALog</a>:</p>
<ul>
<li><b>RESET</b> starts the program over from the start. It's similar to "reboot" on your computer.</li>
<li><b>LOG</b> takes a reading at the exact instant it is pressed and causes the red indicator LED to strobe once.</li>
</ul>
<h2>Main Developers and Contact </h2>
<p>The <a class="el" href="classALog.html">ALog</a> has been developed by Andy Wickert and Chad Sandell at Northern Widget LLC and the University of Minnesota.</p>
<p>For questions related to the Logger library, please send a message to us at <a href="#" onclick="location.href='mai'+'lto:'+'inf'+'o@'+'nor'+'th'+'ern'+'wi'+'dge'+'t.'+'com'; return false;">info@<span style="display: none;">.nosp@m.</span>nort<span style="display: none;">.nosp@m.</span>hernw<span style="display: none;">.nosp@m.</span>idge<span style="display: none;">.nosp@m.</span>t.com</a>. </p><hr/>
<h1>Complete guide: from the basics onward </h1>
<p>Are you new to the <a class="el" href="classALog.html">ALog</a>, Arduino, and/or C/C++ programming? If so, this page is for you. We'll guide you through the steps to install a first simple program on your <a class="el" href="classALog.html">ALog</a> data logger, and introduce you to a few concepts along the way.</p>
<h2>Materials Needed </h2>
<h3>For the basics:</h3>
<ul>
<li><b>1x <a class="el" href="classALog.html">ALog</a> data logger</b></li>
<li><b>1x USB cable that fits the <a class="el" href="classALog.html">ALog</a>'s USB port</b><ul>
<li>USB A-B for version 2.1.0 and prior</li>
<li>USB A-miniB (like an Android cell phone) for version 2.2.0 and later</li>
</ul>
</li>
<li><b>A computer with a USB port</b></li>
</ul>
<h3>For the data logging exercises:</h3>
<ul>
<li><b>1x thermistor</b><ul>
<li>Our instructions are for the <b>CanTherm CWF1B103F3380</b> (available on <a href="https://www.digikey.com/product-detail/en/cantherm/CWF1B103F3380/317-1310-ND/1191085">Digi-Key</a> or from us). This thermistor is 1 meter long and coated in epoxy, making it a good "out-of-the-box" tool, though we recommend calibration if you are going to try to make measurements with greater than factory precision (±1% of nominal resistance value, here 10 kilo-ohms (kΩ) at 25 °C).</li>
</ul>
</li>
<li><b>1x reference resistor</b><ul>
<li>We typically use the <b>Vishay Dale PTF5610K000BYEB</b> for their high precision and temperature stability at a reasonable cost. Note that this factory precision is compounded with the precision of the thermistor when calculating error!</li>
</ul>
</li>
<li><b>1x screwdriver</b>: Slotted. We recommend a 0.4 x 2 mm blade. Good options are <a href="https://www.digikey.com/product-detail/en/wiha/26020/431-1176-ND/510465">this one</a> and its <a href="https://www.digikey.com/product-detail/en/wiha/27220/431-1202-ND/512198">ESD-safe version</a>.</li>
</ul>
<h3>For the field</h3>
<ul>
<li>**"The Basics"** (above):<ul>
<li><b><a class="el" href="classALog.html">ALog</a> data logger</b></li>
<li><b>Computer</b></li>
<li><b>USB cable</b></li>
</ul>
</li>
<li>Any <b>sensor(s)</b> you need</li>
<li><b>Battery pack</b> with power cable attached; solar panel optional; see "Power" section for more details.</li>
<li><b>Housing</b> with any required holes drilled, cable glands and associated waterproofing, and (recommended) attachment points for logger and power supply; see "Housing and waterproofing" section for more details.</li>
<li><b>Tools</b>: my personal toolkit typically includes:<ul>
<li>Screwdrivers (2-3): I recommend one standard larger one with both a Phillips head and a flat head (slotted) for general-purpose use and a small 0.4 x 2 mm blade slotted one for the loggers. Good options for the latter are <a href="https://www.digikey.com/product-detail/en/wiha/26020/431-1176-ND/510465">this one</a> and its <a href="https://www.digikey.com/product-detail/en/wiha/27220/431-1202-ND/512198">ESD-safe version</a>. If you have lots of hose clamps, a nut driver becomes a great asset.</li>
<li>Angle cutters</li>
<li>Wire stripper</li>
<li>Spare wire</li>
<li>Multimeter</li>
<li>Adjustable wrench (mine in the photo is larger than is needed)</li>
<li>Socket wrench (can be optional if you know that you won't need it)</li>
<li>Hex wrenches (Allen wrenches / church keys) (I have English and Metric sets, but don't always bring both)</li>
<li>Portable soldering iron: battery-powered (you get maybe 15-20 minutes on a 4x AA model) or butane</li>
<li>Lead-free solder</li>
<li>Electrical tape</li>
<li>Hose clamps</li>
<li>Permanent markers (I like multiple sizes of Sharpies)</li>
<li>Cable ties</li>
</ul>
</li>
</ul>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ToolRoll.png" alt="Andy&apos;s tool
roll." title="Andy&apos;s tool roll."/>
</div>
<p>\  <h2>A few definitions </h2>
<ul>
<li>A <b>microcontroller</b> is a teeny tiny computer that has its own:<ul>
<li>Processor for performing computations</li>
<li>Memory for storing programs and variables</li>
<li>Metal "pins" to connect to and interact with other devices (see immediately below)</li>
<li>An oscillator, such as the <a class="el" href="classALog.html">ALog</a> BottleLogger's 8 MHz crystal, sets the speed of the microcontroller's computation. This means that the <a class="el" href="classALog.html">ALog</a> BottleLogger is an 8 MHz computer.</li>
</ul>
</li>
<li>A <b>pin</b> is one of the "legs" on the microcontroller chip. Electrical power or signals flow through these. Many of these are connected to the <b>screw terminals</b> on the <a class="el" href="classALog.html">ALog</a> board.</li>
<li><code>C</code> and <code>C++</code> are <b>programming languages</b>.<ul>
<li>Programs written in these languages must be <b>compiled</b>. This means that they are turned into bytes (1s and 0s) by another piece of software before being made executable and (in our case) uploaded to a small board.</li>
</ul>
</li>
<li><b>Arduino</b> is a software and hardware standard for microcontroller projects.<ul>
<li>They are best known for the Arduino Uno board (and its predecessors).</li>
<li>Also important &ndash; and used by us &ndash; are their extensive software libraries to assist us in programming AVR microcontrollers.</li>
<li><b>AVR</b> is the family of microcontrollers most commonly used by Arduino projects.</li>
</ul>
</li>
<li>The <b><a class="el" href="classALog.html">ALog</a> BottleLogger</b> is a lightweight and inexpensive low-power open-source data logger that incorporates elements of the Arduino system, and can be programmed through the Arduino IDE.</li>
</ul>
<h2>Looking at your board: </h2>
<p>Your <a class="el" href="classALog.html">ALog</a> board should look something like this. It has a lot of components. We'll start to look at them in more detail once you wire the board up.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ALogBottleLogger220.png" alt="ALog BottleLogger v2.2.0 top
photo" title="ALog BottleLogger v2.2.0 top photo"/>
</div>
<p>\  <em><b><a class="el" href="classALog.html">ALog</a> BottleLogger v2.2.0 top photo</b></em></p>
<h3>Dimensions: namesake</h3>
<p>The dimensions of the <a class="el" href="classALog.html">ALog</a> BottleLogger are perfect to slip it into a Nalgene water bottle: these are often easier to find than gasketed boxes, especially if you're in the outdoors (or outdoors shops).</p>
<h3>"Chunky" design for the field</h3>
<p>Yes, we use the big, chunky, old-school SD cards, USB ports, and barrel jack connectors. And we love 'em. Why? Have you ever tried to connect cables with mittens in Minnesota-frigid temperatures? Have you ever dropped a micro-SD card (or other object the size of your pinky nail) into a beautiful bed of colorful oak leaves, stand of prairie grasses, or a lake? You'd better hope that your missing item is as big and recognizable as possible. We call it designing for reality.</p>
<p>(An update... while we love the old-school cool of the big USB A-B cable, we\ couldn't help but notice that tons of us were traveling with A-micro-B cables\ thanks to Android phones, but had to make a special effort to remember to bring\ our A-B cables to the field. So we've made a recent (2017) update to the USB\ port in our design.)</p>
<h3>What does it have?</h3>
<ul>
<li>A teeny tiny computer running at 8 MHz</li>
<li>An SD card to save data</li>
<li>A real-time clock and its backup battery to save the time</li>
<li>A USB port to upload programs and talk to the computer</li>
<li>A bunch of "screw terminals" to connect wires for sensors, etc.</li>
<li>Six pairs of holes for "reference resistors" to act as standards for certain types of measurements ("analog")</li>
<li>A blinky light to tell you what's going on</li>
</ul>
<h3>Pins</h3>
<p>The metal connections between the microcontroller (teeny tiny computer) and any external component of the system (e.g., power supply, sensors) are called "pins".</p>
<p>You are not attaching anything directly to the pins on the integrated circuit, obviously; your interface to the <a class="el" href="classALog.html">ALog</a> data logger will be primarily through the screw terminals (which in turn are discussed immediately below) at the edges of the board. I refer to each screw terminal as a "pin" or "port", or simply as a "screw terminal"; there is no hard-and-fast language for this, except insofar as only those microcontroller pins that are exposed to the outside world via screw terminals are called "ports" in this documentation.</p>
<p>The Alog BottleLogger follows the Arduino Uno convention for pin numbering.</p>
<p>More information on pins can be found towards the end of this document, in the "Pin definitions" section.</p>
<h3>Those little numbers and letters by the screw terminals</h3>
<p>Those black things on the sides with screw heads are the "screw
terminals". They clamp down on wires to connect peripherals to the <a class="el" href="classALog.html">ALog</a> BottleLogger, securely. There are several different sets of letters by them. These are:</p>
<h4>VCC</h4>
<p>"Voltage of the common connector": this is raw power from the batteries. Keep it above 3.6V and below 5.5V. Any higher and you fry things; any lower and the system starts shutting down. We usually use:</p>
<ul>
<li>USB (5V)</li>
<li>3x AA or D batteries</li>
</ul>
<h4>5V</h4>
<p>This is 5V power, supplied by a switchable charge pump. Note that it will be closer to 5.2V if very small voltages are required. It is most often used to power 5V devices.</p>
<h4>3V3</h4>
<p>This is 3.3V power, supplied by a switchable voltage regulator. It powers 3.3V devices and is used as a reference (and often a power source) for analog measurements.</p>
<h4>GND</h4>
<p>This is ground. Circuits that start at VCC end here. Don't touch power directly to ground unless you want to destroy something. It is the same as 0V.</p>
<h4>A0, A1, A2, A3, A6, A7 (Analog pins, <a class="el" href="classALog.html">ALog</a> BottleLogger)</h4>
<p>These are the analog pins. They measure input voltages in a range between 0 and 3.3 volts. What happened to 4 and 5? They are talking to the real-time clock, and are labeled SDA and SCL on the board.</p>
<p>All analog pins can be used as digital pins as well!</p>
<p>When writing code, the analog pins can be referred to as A0, A1, A2, A3, A6, or A7 safely in all cases.</p>
<p>*Additional &lt;info:*&gt;</p>
<p><em>The analog pins can be referred to by their base numeral (for the <a class="el" href="classALog.html">ALog</a> BottleLogger, 0, 1, 2, 3, 6, or 7) in the <code>AnalogRead(analogPinNumber)</code> command that we'll see below; this is the legacy of early versions of Arduino. They must be elsewhere referred to as A0, A1, A2, A3, A6, or A7.</em></p>
<p><em>A bit of advanced knowledge: "A0" maps to "14", "A1" maps to 15, and so forth until A7 maps to 21; this is because there are 14 digital pins (0-14), so the analog numbers come right after these. Therefore, while I find A0...A7 easier to remember, you may prefer to use the numbers &gt;13, which is equally valid.</em></p>
<h4>D3-INT1, D7, D8 (digital pins, <a class="el" href="classALog.html">ALog</a> BottleLogger)</h4>
<p>These pins can read or write TRUE or FALSE values. For writing, TRUE means full power (VCC) is delivered. False means the pin goes to GND. Reading values with these pins tells you whether the observed voltage is closer to VCC or to GND.</p>
<p>When programming these pins, refer to them by their number alone, dropping the D (and anything after the number that immediately follows the D.</p>
<h5>D3-INT1 (interrupt, <a class="el" href="classALog.html">ALog</a> BottleLogger)</h5>
<p>This pin can be used as an interrupt, to observe an event. We often use it with anemometers (spin counters) and tipping-bucket rain gauges.</p>
<p>When programming with this pin as an interrupt, use the following syntax:\ <code>attachInterrupt(digitalPinToInterrupt(3), ...)</code></p>
<p>If you insert the interrupt number (1), this will correspond to Pin 3 on the Arduino Uno or Alog BottleLogger, but will refer to Pin 1 on ARM-based devices, so this will cause compatibility problems.</p>
<h5>D7 and D8: (PWM, <a class="el" href="classALog.html">ALog</a> BottleLogger)</h5>
<p>Pulse-width modulation. Actually, this isn't written on the board. It uses the analogWrite() function in Arduino and simulates a voltage between GND (0V) and VCC by turning itself on and off very quickly, repeatedly.</p>
<h4>Rx and Tx</h4>
<p>Receive and transmit: these are your serial pins. Be careful: they are also attached to the USB port (to talk to your computer), so they must be shared. For the electronics-savvy: they are connected to the computer via 1 kΩ in-series resistors, so external sensors will override USB communications. See "UART", below.</p>
<h4>MOSI, MISO, SCK</h4>
<p>These are the pins for the SPI communications protocol. This protocol is used to communicate with the SD card. You may also use it with some external sensors. See section "SPI", below.</p>
<h4>SDA, SCL</h4>
<p>These are the pins used for the I2C communications protocol. This works with the real-time clock, and can connect to external peripherals as well. For the tech-heads: we are updating the design to optimize this for 3.3V design, common among I2C devices. See section "I2C", below.</p>
<h3>Special pins</h3>
<p>The <a class="el" href="classALog.html">ALog</a> BottleLogger has several pins that are used for dedicated functions. These are:</p>
<ul>
<li><b>Pin 2:</b> Interrupt connected to clock: triggers logger to wake</li>
<li><b>Pin 4:</b> External (sensor) power 3.3V and 5V regulator on/off switch</li>
<li><b>Pin 5:</b> The "LOG" (also referred to as "LOG NOW") button uses this pin to tell the logger to wake up and take a reading immediately.</li>
<li><b>Pin 7:</b> Clock and SD card power on/off switch</li>
<li><b>Pin 8:</b> Message-flashing LED on/off</li>
<li><b>Pin 10:</b> The chip-select pin for the SPI communication to the SD card; more on this in the "SPI" section, below</li>
</ul>
<p>In addition, there are three significant digital interfaces that have uses internal to the <a class="el" href="classALog.html">ALog</a> but that may also be used to communicate with external sensors:</p>
<h4>UART</h4>
<p>The UART, or universal asynchronous receiver&ndash;transmitter, communicates to the computer via a USB&ndash;serial converter (model number FT231X). It transmits these signals through in-series 1 kΩ resistors that act to limit the current that passes in this signal, with the goal of allowing external sensors that communicate via the UART to take precedence over USB&ndash;serial communications to the computer. While this is available and functions, we recommend against its use as there will almost certainly be some amount of interference between the communications with the computer and with the sensor. In-development versions of <a class="el" href="classALog.html">ALog</a> boards will have multiple UART ports, and these will include a dedicated port for communication with the computer and other UART ports for use with sensors.</p>
<ul>
<li><b>Pin 0:</b> Rx (external device sends, logger receives)</li>
<li><b>Pin 1:</b> Tx (logger sends, external device receives)</li>
</ul>
<h4>SPI</h4>
<p>SPI is a 4-wire communication protocol (i.e., bus): three wires/pins are shared between all SPI devices, while a fourth one is used as a "chip
select" pin that is set LOW for communication with the logger and HIGH when all communications should be ignored.</p>
<p>It is straightforward to extend SPI to other devices by configuring one of the pins on the <a class="el" href="classALog.html">ALog</a> data logger to be the new "chip select" pin. In addition to this, the pins with a set configuration are:</p>
<ul>
<li><b>Pin 11:</b> MOSI (logger sends, external device receives)</li>
<li><b>Pin 12:</b> MISO (external device sends, logger receives)</li>
<li><b>Pin 13:</b> SCK (serial clock)</li>
</ul>
<p>The abbreviations stand for "Master out, slave in", "master in, slave
out", and "serial clock". I'm really not OK using the term "slave" for about a million reasons, so whenever I need to refer to the device attached to the logger, I will write "agent" or "external device". This goes for any bus &ndash; not just SPI.</p>
<p>Additional information on SPI and setting up additional SPI devices may be found at:<a href="https://www.arduino.cc/en/reference/SPI">https://www.arduino.cc/en/reference/SPI</a>.</p>
<h4>I2C</h4>
<p>I2C is a 2-wire communications protocol. It is used to communicate with the real-time-clock (RTC, model number DS3231), as well as many sensors. Each attached device has its own address, enabling <b>up to 128 sensors</b> to be attached to the same I2C port as the clock. But just be careful that your sensor code is good &ndash; if it is not and halts the I2C system, it could affect the clock and therefore the entirety of the operations of the ALog!</p>
<ul>
<li><b>Pin A4</b> (= pin 18): SDA (Serial Data)</li>
<li><b>Pin A5</b> (= pin 19): SCL (Serial Clock)</li>
</ul>
<h3>Reference resistor headers</h3>
<p>The pair of plastic vertical "headers" &ndash; things with holes in them for wires &ndash; are for reference resistors to read analog resistance-based sensors. A simple example is a thermistor, and we'll cover that farther on down here. For now, just consider these resistors to be standards against which many analog sensors will be compared to measure their resistance values.</p>
<h3>Buttons: RESET and LOG</h3>
<p>There are two buttons on the <a class="el" href="classALog.html">ALog</a>:</p>
<ul>
<li><b>RESET</b> starts the program over from the start. It's similar to "reboot" on your computer.</li>
<li><b>LOG</b> takes a reading at the exact instant it is pressed and causes the red indicator LED to strobe once.</li>
</ul>
<h2>Programming Arduino-based systems: Focus on the <a class="el" href="classALog.html">ALog</a> </h2>
<h3>Download and install the Arduino IDE</h3>
<p>The Arduino IDE (Integrated Development Environment) is the current programming environment we use to write and upload programs to the <a class="el" href="classALog.html">ALog</a>. (Other options exist, but this is the most beginner-friendly.) We haven't yet tested the brand-new web editor, so we'll be suggesting an old-fashioned download. And if you're deploying these in the field, you'll need the downloaded version! Go to <a href="https://www.arduino.cc/en/Main/Software">https://www.arduino.cc/en/Main/Software</a>. Get it, install it, go.</p>
<h3>Set up the <a class="el" href="classALog.html">ALog</a> boards definitions</h3>
<p>The <a class="el" href="classALog.html">ALog</a> boards are "third-party" Arduino boards, so you'll have to set up support for these boards yourself. We've made a pretty thorough walkthrough that you can view here at <a href="https://github.com/NorthernWidget/Arduino_Boards">https://github.com/NorthernWidget/Arduino_Boards</a>, and have included those installation instructions here, immediately below.</p>
<p>Each board will be added as an entry to the Arduino <b>Tools</b> &gt; <b>Board</b> menu.</p>
<p>Go to <b>File</b> &gt; <b>Preferences</b> (or <b>Arduino</b> &gt; <b>Preferences</b> on Mac).</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/File_Preferences.png" alt="Open the Arduino IDE
preferences" title="Open the Arduino IDE preferences."/>
</div>
<p>\  preferences"</p>
<p><em><b>Open the Arduino IDE preferences</b></em></p>
<p>Open 'Additional Boards Manager URLs', and paste the following in either the box for <b>Additional Boards Manager URLs</b>, or, if this is populated, the window that pops up when you hit the button to the right of the <b>Additional Boards Manager URLs</b> text entry area: </p><pre class="fragment">https://raw.githubusercontent.com/NorthernWidget/Arduino_Boards/master/package_NorthernWidget_index.json
</pre><div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/PreferencesWindow.png" alt="Paste the URL
here"/>
</div>
<p>\  <em><b>Paste the URL here.</b></em></p>
<p>![Unless you already have done that for third-party boards... in that case, open this frame and paste the URL here.](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardURLs_list.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardURLs_list.png</a> "Unless you already have done that for third-party boards... in that case, open this frame and paste the URL here.")\  <em><b>Unless you already have done that for third-party boards... in that case, open this frame and paste the URL here.</b></em></p>
<p>Now, go to <b>Tools</b> &gt; <b>Board</b> &gt; <b>Boards Manager...</b>.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/Tools_Boards_BoardManager.png" alt="Open the boards manager
here." title="Open the boards manager here."/>
</div>
 <em><b>Open the boards manager here.</b></em></p>
<p>Click it, and the following window will appear:</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardsManager.png" alt="Boards
Manager." title="Boards Manager."/>
</div>
<p>\  <em><b>Boards Manager.</b></em></p>
<p>if you type in "Northern Widget" (or usually just "Northern" as well), you should see an option to install board files for Northern Widget Arduino compatible boards.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardsManager_Northern.png" alt="Northern Widget
boards." title="Northern Widget boards."/>
</div>
<p>\  <em><b>Northern Widget boards.</b></em></p>
<p><em><b>If Northern Widget options do not appear.</b></em> restart your Arduino IDE and try again.</p>
<p>Click "Install" to add the NorthernWidget boards to your list. At the time of writing, we support only AVR boards, but this may change soon.</p>
<p>![<a class="el" href="classALog.html">ALog</a> (AVR) support installed.](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardsManager_Northern_Done.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/BoardsManager_Northern_Done.png</a> "ALog (AVR) support installed.")\  <em><b><a class="el" href="classALog.html">ALog</a> (AVR) support installed.</b></em></p>
<p>Now, when you select the Boards list, you will see a collection of new boards for Northern Widget.</p>
<p>You will then want to change your chosen board to the board that you have. At the time of writing, this is probably the "ALog BottleLogger
v2"; the "legacy" option is used for v2.0.0-beta and prior, and there are fewer of these boards in circulation.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Arduino_Boards/Tools_Boards_NorthernWidget_ALog_BottleLogger_v2.png" alt="Select the proper
board." title="Now, when you go to Tools &gt; Board, you should see the Northern Widget ALog boards. Select the proper board."/>
</div>
<p>\  <em><b>Select the proper board.</b></em></p>
<p><b>That's it! You're done, and ready to rock and roll... er, collect data, with your <a class="el" href="classALog.html">ALog</a> data logger.</b></p>
<h3>Download and install the custom <a class="el" href="classALog.html">ALog</a> libraries</h3>
<p>The <a class="el" href="classALog.html">ALog</a> also relies on some custom software libraries. These are collections of computer code that help make everything from running basic data logging utilities to interfacing with specific sensors easier. We're introducing you to these libraries up here, even though they won't be needed until quite a bit further down. While we highly recommend them and they are very helpful for field work, you can also program the <a class="el" href="classALog.html">ALog</a> without them! In fact, the earlier examples (below) do not include the custom libraries.</p>
<h4>Option 1: downloading and installing through the Arduino IDE</h4>
<p><em><b>Currently not recommended, at least until all components can be downloaded this way</b></em></p>
<p><em><b>Stable versions, but outdated during times of rapid development</b></em></p>
<p>The Arduino IDE has a library manager! Here we will walk you through how to use it to obtain and install the requisite libraries. This uses the graphical interface, but can take longer than, "Option 2", below.</p>
<p>At the moment, you will also have to download the stable release (below) and copy the SFE_BMP180 library into your "Arduino/libraries" folder; we're working to streamline this.</p>
<p>First, open the libraries manager.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/libraries_sketch-include-manage.png" alt="Open the libraries
manager." title="Open the libraries manager."/>
</div>
<p>\  "libraries"</p>
<p>Then, look up each of the three core libraries:</p>
<p>DS3231 (real-time clock):</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/libraryDS3231.png" alt="DS3231
library." title="DS3231 library."/>
</div>
<p>\  SdFat (SD card):</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/librarySdFat.png" alt="SdFat
library." title="SdFat library."/>
</div>
<p>\  <a class="el" href="classALog.html">ALog</a> (all data logging!):</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/libraryALog.png" alt="ALog
library." title="ALog library."/>
</div>
<p>\  Once this is done, go to the instructions for Option 2 (immediately below) to get the SFE_BMP180 library.</p>
<h4>Option 2: direct installation from a prepared file archive</h4>
<p><em><b>Not automated in the IDE but much simpler!</b></em></p>
<h5>Download:</h5>
<p><b>Stable release: <a href="http://northernwidget.com/ALog_libraries/stable/ALog_libraries.zip">[ZIP]</a> <a href="http://northernwidget.com/ALog_libraries/stable/ALog_libraries.tar.gz">[TAR.GZ]</a> (recommended)</b></p>
<p>Nightly build: <a href="http://northernwidget.com/ALog_libraries/nightly/ALog_libraries.zip">[ZIP]</a> <a href="http://northernwidget.com/ALog_libraries/nightly/ALog_libraries.tar.gz">[TAR.GZ]</a> (for only those who can tolerate things breaking once in a while)</p>
<h5>Extract/Install:</h5>
<p>Unzip the archive, and place the contents in your "**Arduino/libraries**" folder. This should be in your home directory or your Documents. Then restart the Arduino IDE (if it is open).</p>
<h3>Learn some basics of programming in the Arduino language</h3>
<p>If you're not a programmer (yet!), you might be thinking, "yeah, right,
I can't program."</p>
<p>But we say, **"Yeah, right! You can program!"** We'll walk you through it:</p>
<ul>
<li>First, we'll point you to some nice resources</li>
<li>Then, we'll show you how to write a simple code to blink your LED.</li>
<li>Finally, you'll combine your LED blinking with serial communications with your computer.</li>
</ul>
<p>*[For the folks already in the know: the Arduino programming language is variant of C/C++.]*</p>
<h3>Programming resources</h3>
<h4>Tutorials from Adafruit</h4>
<p>These are serious good. You can follow along with them! <a href="https://learn.adafruit.com/series/learn-arduino">https://learn.adafruit.com/series/learn-arduino</a> If you follow them, note that the <a class="el" href="classALog.html">ALog</a> BottleLogger can take only 3.6 &ndash; 5.5 volts, and that the LED is controlled by Pin 8 (not 13). Here is their version of the "blink" example that we'll do below. <a href="https://learn.adafruit.com/adafruit-arduino-lesson-1-blink?view=all">https://learn.adafruit.com/adafruit-arduino-lesson-1-blink?view=all</a> Look at as many of these as you want! Yes, your <a class="el" href="classALog.html">ALog</a> can:</p>
<ul>
<li>Sense sensors</li>
<li>Motor motors</li>
<li>Blink blinky things</li>
<li>Text text via the serial monitor</li>
<li>Type text onto a display screen</li>
<li>More more more!</li>
</ul>
<h4>The full reference guide</h4>
<p>Yes, there <b>is</b> a manual! The full reference guide to programming Arduino devices is here <a href="https://www.arduino.cc/en/Reference/HomePage">https://www.arduino.cc/en/Reference/HomePage</a>.</p>
<h4>The internet</h4>
<p>We're not kidding. We type things into our favorite search engine when we can't figure them out and/or are too tired to think. 90+% of the time, this gets us to the right answer. Sometimes it takes longer than others. Arduino forums and StackExchange are pretty great: <a href="https://forum.arduino.cc/"><b>Arduino forums</b></a> <b><a href="https://arduino.stackexchange.com/">Arduino stack exchange</a></b> [stack exchange is just about the most effective way of conveying the right answers for how to do things that I've (Andy has, that is!) ever seen on the internet]</p>
<h3>Basic syntax of C programming</h3>
<p>Programming languages all have ways in which logical thoughts are placed into text that is entered into a computer. Here is a non-exhaustive list of these. It is not intended to be complete, but to give you some essential tools to start reading the code that appears below.</p>
<h4>Defining variables</h4>
<p>Each variable needs to be defined before it is used.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> isOn=False; <span class="comment">// Boolean: True (1) or False (0)</span></div><div class="line"><span class="keywordtype">int</span> x=50; <span class="comment">// Integer (this works for values between -32768 and 32767).</span></div><div class="line">          <span class="comment">// For broader applicability, look up uint32, int64, etc.</span></div><div class="line"><span class="keywordtype">float</span> _my_float = 1000.293; <span class="comment">// &quot;Floating point&quot; (decimal) number</span></div><div class="line"><span class="keywordtype">char</span> letter=<span class="charliteral">&#39;h&#39;</span> <span class="comment">// This is a letter, but is represented in ASCII, so is</span></div><div class="line">                <span class="comment">// also a 1-byte number</span></div></div><!-- fragment --><p>Each of these goes: <b>variable_type variable_name = variable_value ;</b> For more information on types, see the Sparkfun Electronics tutorial at <a href="https://learn.sparkfun.com/tutorials/data-types-in-arduino">https://learn.sparkfun.com/tutorials/data-types-in-arduino</a>. For what you are doing right now, a general idea of what these definitions are and what they look like should work.</p>
<h4>Comments</h4>
<p>Ignore lines that start with:</p>
<div class="fragment"><div class="line"><span class="comment">// [compiler doesn&#39;t care what is here, but you can read it]</span></div></div><!-- fragment --><p>And lines that are between</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> whatevs</span></div><div class="line"><span class="comment"> */</span></div></div><!-- fragment --><p>These are for the benefit of the humans reading the code. Comment your code clearly and thoroughly!</p>
<h4>Line endings</h4>
<p>Lines must be terminated with semicolons.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> a=5;</div></div><!-- fragment --><h4>Operations</h4>
<p>Basic arithmetic operators (<code>+, -, *, /</code>) work. Division of two integers results in "floor division, or rounding down the result. There are also logical operators (<code>&lt;, &gt;, ==</code>, etc.)</p>
<h4>Loops and Statements</h4>
<p>These are ways to control the flow of a code. I'm afraid that this introduction to the <a class="el" href="classALog.html">ALog</a> would be diluted by the details of these. I point the interested reader to the main Arduino reference: <a href="https://www.arduino.cc/en/Reference/HomePage">https://www.arduino.cc/en/Reference/HomePage</a>.</p>
<h2>Connecting the <a class="el" href="classALog.html">ALog</a> and Computer </h2>
<p>Use a USB cable to connect the <a class="el" href="classALog.html">ALog</a> to your computer. (Photo from <a class="el" href="classALog.html">ALog</a> v2.0.0; v2.2.0+ use microUSB, like Android cell phones.)</p>
<p>![Insert USB cable (photo R. Schulz).](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/InsertUSB.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/InsertUSB.png</a> "Insert USB cable (photo R. Schulz).")\  Then, using the Arduino IDE, select the name of the USB-serial port that is connected to the <a class="el" href="classALog.html">ALog</a>.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/SerialPort.png" alt="USB-Serial port
select." title="USB-Serial port select."/>
</div>
<p>\  Now your <a class="el" href="classALog.html">ALog</a> is ready for communications and programming.</p>
<h2>Example Programs: Writing and Uploading </h2>
<p>Arduino programs, often called "sketches", are how you tell the <a class="el" href="classALog.html">ALog</a> data logger what to do. Here is some information to get you started.</p>
<h3>A new program</h3>
<p>If you open a new Arduino program, it will look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup() {</div><div class="line">  <span class="comment">// put your setup code here, to run once:</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop() {</div><div class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p><code>setup()</code> and <code>loop()</code> are both <b>functions</b>. These are specific sets of code that are executed when their names are called in the code. These two functions are special in that:</p>
<ol type="1">
<li>Every Arduino program much have them.</li>
<li>They do not need to be called by code that you write: Arduino automatically interprets and, indeed, requires that these be included.<ul>
<li>Everything inside the curly braces after <code>setup()</code> is run once, when the data logger starts running</li>
<li>Everything inside the curly braces after <code>loop()</code> is run continuously, after <code>setup()</code>.</li>
</ul>
</li>
</ol>
<p>Before these functions, you can place all of your variable definitions.</p>
<h3>Uploading code to the <a class="el" href="classALog.html">ALog</a> data logger</h3>
<p>Once your code is written &ndash; either as a copy/paste of this or as your own &ndash; save your code. All Arduino sketches need to be within their own folder. After this, you can hit the "upload" button (right arrow) to load the code to the board. (The check mark to the left will test if your code compiles.)</p>
<p>![Upload sketch (program) to board.](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/Uploading.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/Uploading.png</a> "Uploading sketch (program) to board.")\  <h3>Blink</h3>
<p>Let's make a blinky light turn on and off! On the <a class="el" href="classALog.html">ALog</a>, <b>pin 8</b> is attached to a red indicator LED. Here is some code to create a syncopated blinky light.</p>
<div class="fragment"><div class="line"><span class="comment">// Syncopated LED blink</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup() {</div><div class="line"> <span class="comment">// put your setup code here, to run once:</span></div><div class="line"> pinMode(8, OUTPUT); <span class="comment">// &quot;Output&quot; means that the maximum current possible will be available at Pin 8</span></div><div class="line">                     <span class="comment">// to drive the LED</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop() {</div><div class="line"> <span class="comment">// put your main code here, to run repeatedly:</span></div><div class="line"> digitalWrite(8, HIGH); <span class="comment">// Turn power to light ON</span></div><div class="line"> delay(750); <span class="comment">// Wait for 750 milliseconds</span></div><div class="line"> digitalWrite(8, LOW); <span class="comment">// Turn power to light OFF</span></div><div class="line"> delay(250);</div><div class="line"> digitalWrite(8, HIGH);</div><div class="line"> delay(250);</div><div class="line"> digitalWrite(8, LOW);</div><div class="line"> delay(250);</div><div class="line">}</div></div><!-- fragment --><p>Look at the comments in the code for information on what each of the commands do; these are detailed more below in the USB/Serial communications section.</p>
<h3>USB/Serial communications</h3>
<p>A second important piece of your work with the Arduino is to communicate with it. We'll start with one-way communications, with the <a class="el" href="classALog.html">ALog</a> talking to your computer. We will still flash the LED, and will add in information on how to define a variable outside of these two functions. The comments give you some general idea of what each section does; I will break down the importance of each section below.</p>
<p><em>Before running this code, open the serial monitor and</em> <em><b>change your baud rate to 38400 bps!</b></em></p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/Uploading.png" alt="Open the serial
monitor." title="Open the serial monitor."/>
</div>
<p>\  (Note that if I would have clicked, an error message would have popped up below saying that it cannot find a device at the given port: this is because I have no board plugged in. If you get this message and <b>do</b> have a board plugged in, go to <b>Tools</b> &gt; <b>Port</b> &gt; **[new port that you pick]**)</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ArduinoScreenshots/SetBaud.png" alt="Change the baud
rate." title="Change the baud rate."/>
</div>
<p>\  <div class="fragment"><div class="line"><span class="comment">// Global variables</span></div><div class="line"><span class="comment">// These variables are available to any function inside your code</span></div><div class="line"><span class="keywordtype">int</span> LEDpin = 8;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup() {</div><div class="line">  <span class="comment">// put your setup code here, to run once:</span></div><div class="line">  Serial.begin(38400);</div><div class="line">  pinMode(LEDpin, OUTPUT);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop() {</div><div class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></div><div class="line">  Serial.println(<span class="stringliteral">&quot;Hi, computer.&quot;</span>);</div><div class="line">  delay(1000);</div><div class="line">  digitalWrite(LEDpin, HIGH);</div><div class="line">  delay(500);</div><div class="line">  digitalWrite(LEDpin, LOW);</div><div class="line">}</div></div><!-- fragment --><p>Let's break this down a little bit:</p>
<h4>Global variables and pin definitions</h4>
<div class="fragment"><div class="line"><span class="comment">// Global variables</span></div><div class="line"><span class="comment">// These variables are available to any function inside your code</span></div><div class="line"><span class="keywordtype">int</span> LEDpin = 8;</div></div><!-- fragment --><p>Here we are defining the pin number that controls the LED. This is Pin 8, which is a digital pin; analog pins would generally have an "A" before their pin number, and can also be used for digital input and output.</p>
<h4>Setup</h4>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup() {</div><div class="line">  <span class="comment">// put your setup code here, to run once:</span></div><div class="line">  Serial.begin(38400);</div><div class="line">  pinMode(LEDpin, OUTPUT);</div><div class="line">}</div></div><!-- fragment --><p>"**Serial**" is a library for USB-Serial communications between the computer and the attached Arduino. It is a core part of Arduino, and therefore does not have to be "included" at the top in the way the <a class="el" href="classALog.html">ALog</a> library (farther below) must be. To view serial communications, you may open the serial monitor in the Arduino IDE (the figures immediately above describe how to do this).</p>
<p>Within the <code>Serial.begin()</code> command, we set the <b>baud rate</b> to "38400"; this is in bits per second. <em>Technical note: We choose this rate because it is closer to being integer-divisible by our 8 MHz processor clock speed than other baud rates are.</em></p>
<p>the <b>pinMode</b> command can be set to <b>input</b> or <b>output</b>; "input" means that the pin is ready to read an incoming signal; output means that it maximizes the amount of electrical current it can source to send a strong output signal that is also enough (40 mA absolute maximum) to power basic devices.</p>
<h4>Loop</h4>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loop() {</div><div class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></div><div class="line">  Serial.println(<span class="stringliteral">&quot;Hi, computer.&quot;</span>);</div><div class="line">  delay(1000);</div><div class="line">  digitalWrite(LEDpin, HIGH);</div><div class="line">  delay(500);</div><div class="line">  digitalWrite(LEDpin, LOW);</div><div class="line">}</div></div><!-- fragment --><p><b>Serial.println</b> prints the requested text and then moves ahead to a new line for the next print command (if any).</p>
<p><b>delay</b> takes an argument in milliseconds that describes how long you would like the logger to do nothing but count time passing.</p>
<p><b>digitalWrite</b> turns an output pin ON (HIGH) or OFF (LOW). When HIGH, the pin is sending current at a voltage corresponding to VCC (i.e., the positive voltage for the system). When low, it is sending current at a voltage corresponding to GND (ground / Earth).</p>
<h2>Using the <a class="el" href="classALog.html">ALog</a> library </h2>
<p>The full reference to the <a class="el" href="classALog.html">ALog</a> library is located at\ <a href="http://northernwidget.github.io/ALog/classALog.html">http://northernwidget.github.io/ALog/classALog.html</a>.</p>
<p>The following sections walk you through the functionality.</p>
<h3><a class="el" href="classALog.html">ALog</a> library components</h3>
<p>The <a class="el" href="classALog.html">ALog</a> library contains:</p>
<ul>
<li><b>Global variables</b> that are important across the entire library, such as pins based on the design of the board that you are using and variables that determine how frequently the logger will read sensors;</li>
<li>An <b>object-oriented interface</b> that allows the user to interact with the <a class="el" href="classALog.html">ALog</a> library;</li>
<li><b>Utility code</b> that carries our behind-the-scenes work to keep the <a class="el" href="classALog.html">ALog</a> running well; and</li>
<li><b>Sensor functions</b> that are pre-written and allow users to connect with sensors as part of a single-line function call.</li>
</ul>
<h4>Object-oriented interface</h4>
<p>The end user can <em><b>instantiate</b></em> the <a class="el" href="classALog.html">ALog</a> class, that is, create one's own version of it for a particular purpose, as follows:</p>
<div class="fragment"><div class="line"><a class="code" href="classALog.html">ALog</a> alog;</div></div><!-- fragment --><p>Here, "ALog" is the class, and "alog" is one's instance of the class. It's a bit like picking out a Lego set from a store: it becomes yours, and you can build what you like with it, within the constraints of the pieces that you have.</p>
<p>You may call any function within the <a class="el" href="classALog.html">ALog</a> class by typing <code>alog.&lt;function_name&gt;(&lt;parameters_to_pass&gt;)</code>.</p>
<h4>Utility code (both "private" and "public" functions)</h4>
<p>The utility code is the unseen backbone of the <a class="el" href="classALog.html">ALog</a> library, and much of the reason that I wrote it in the first place. It handles power consumption, device stability, communications with the user, real-time clock management, and reading and writing files to and from the SD card.</p>
<h5>Sleeping and waking</h5>
<p>The sleep mode is the most important piece of the <a class="el" href="classALog.html">ALog</a> data logger. It's the superlative of when you close the lid of a laptop computer: the <a class="el" href="classALog.html">ALog</a> goes from drawing at least 6.7 milliamps to just 53 microamps &ndash; that's 0.053 milliamps, for a <b>greater than 100x increase in power efficiency</b>, and therefore battery life.</p>
<p>The internal sleep functions are activated by the end-user as part of this command: </p><pre class="fragment">alog.goToSleep_if_needed(); // Send logger to sleep
</pre><p>When the logger <b>wakes up</b>, it takes readings and then goes back to sleep. How does it wake up? There are two ways:</p>
<ol type="1">
<li>The real-time clock's alarm function triggers an interrupt.</li>
<li>An event activates a second interrupt and causes it to wake; an example is a bucket tip from a rain gauge.</li>
</ol>
<p>The logger can also be run in a mode to <b>maximize logging speed</b> (around 10 Hz at top speed, but not well-measured at the time of writing) and never sleep!</p>
<h5>Real-time clock</h5>
<p>The real-time clock maintains the absolute time to within ±0.432 s/day. It also operates two alarms, which can be used to trigger the <a class="el" href="classALog.html">ALog</a>.</p>
<p>As a safety feature, we enable the second of these alarms to go off several after the first one is triggered at the user-specified time. If the first alarm goes off, the second is disabled and advanced farther into the future. Otherwise, if the first alarm doesn't go off, the second alarm is triggered and the logger advances both alarms to the next logging interval. It also records the time at which the failure of the first alarm took place. Thus far, I have never seen this in use outside of test cases in which we force the first alarm to fail.</p>
<p>Interfacing with the real-time-clock is performed through the <b>DS3231 library</b>, which is a combination of RTClib (a standard real-time clock library by J.-C. Wippler) and code to run the DS3231 written by E. Ayars and edited by A. Wickert.</p>
<p>All times are represented as a <b>UNIX Epoch</b>, seconds since January 1st, 1970. This is a very widespread format with plenty of converters into conventional date/time, and solves the problems of (a) storage of date/time data into a complex data type on a small system, and (b) daylight savings time and leap years.</p>
<h5>SD card</h5>
<p>Utilities to read and write to and from the SD card are managed via the <b>SdFat</b> library, by Bill Greiman. The <a class="el" href="classALog.html">ALog</a> will write to the following files, in rough order of how common their use is:</p>
<p><em><b>Always included:</b></em></p>
<ul>
<li>**[DataFileCustomName].txt**: A data file, with the name chosen by the user; for safety's sake, I always go with 8.3 format, but this is more old habit.</li>
<li><b>header.txt</b>: A header file with the names of each column listed. A new timestamped row is added each time the logger is rebooted, to ensure that the data in the data file may always be matched to their appropriate real-world significance.</li>
</ul>
<p><em><b>Sometimes included:</b></em></p>
<ul>
<li><b>bucket_tips.txt</b> records the times at which a tipping-bucket rain gauge's bucket tips; more tips over a time interval means heavier rain!</li>
<li><b>Camera.txt</b> records the times at which an attached camera that may lack its own clock takes photos or video</li>
<li><b>Oversample.txt</b> contains every individual analog reading that is combined into an oversampled resultant measurement, if the "debug" flag is set to <code>True</code></li>
<li><b>Alarm_miss.txt</b>: Any time the first alarm has not gone off and the backup alarm has had to save the day, a time stamp is written to this file.</li>
</ul>
<p>Power to the SD card is cut between logging intervals to conserve energy. This is one reason why we do not use the built-in Arduino SD library, which cannot handle losing power to the SD card (or at least could not back when I first tried, in 2011!)</p>
<h5>Watchdog timer</h5>
<p>The watchdog timer will automatically reboot the <a class="el" href="classALog.html">ALog</a> data logger if it stalls out while logging for more than 8 seconds. This can help to recover from any software errors, as well as any unforeseen circumstances arising in the field (e.g., jostled while logging causing a disruption of some connections). This can really save the day!</p>
<h5>LED messages</h5>
<p>These messages are flashed on the large red LED. Those in bold are those that you may see most commonly.</p>
<ul>
<li>Syncopated: <b>daaaa-da-daaaa-da-daaaa-da</b>: Clock has reset to the year 2000! Please set the clock.</li>
<li><b>LONG-short-short</b>: All is good! Starting to log.</li>
<li>5 quick flashes: Missed first alarm; caught by backup alarm. Rebooting logger.</li>
<li><b>20 quick flashes</b>: SD card failed, or (more likely) is not present. This also happens if it is not seated properly; reseat the card and try again.</li>
<li>50 quick flashes: you have tried to reassign a pin critical to the <a class="el" href="classALog.html">ALog</a> to another function; this will most likely break the system. Check your code and re-upload.</li>
<li>100 quick flashes: your Arduino model is not recognized by the <a class="el" href="classALog.html">ALog</a> library!</li>
</ul>
<h5>EEPROM: Serial number and calibration values for voltage regulators</h5>
<p>The EEPROM of an <a class="el" href="classALog.html">ALog</a> data logger or other Arduino-based device is the memory that remains unchanged even if it is reprogrammed. It holds important <b>identifying and calibration information</b> about the <a class="el" href="classALog.html">ALog</a> data logger.</p>
<ul>
<li>The <b>serial number</b> of the data logger is a 16-bit integer held in the first two bytes of the EEPROM (bytes 0 and 1)</li>
<li>The <b>measured voltage of the 3.3V regulator</b> on the <a class="el" href="classALog.html">ALog</a> BottleLogger, if recorded, is stored in bytes 2-5 of the EEPROM.</li>
<li>The <b>measured voltage of the 5V charge pump</b> on the <a class="el" href="classALog.html">ALog</a> BottleLogger, if recorded, is stored in bytes 6-9 of the EEPROM.</li>
</ul>
<p>These can be read by the functions:</p>
<ul>
<li>get_serial_number()</li>
<li>get_3V3_measured_voltage()</li>
<li>get_5V_measured_voltage()</li>
</ul>
<p>You can use these functions with sensors by passing the results from a call to <code>get_3V3_measured_voltage()</code> or <code>get_5V_measured_voltage()</code> to functions as <code>Vsupply</code> or <code>Vref</code>, these being the supply an reference voltages for the sensors, respectively.</p>
<h4>Sensor functions (mostly "public" functions, exposed to the user)</h4>
<p>The full index of the sensor functions, along with ways to use them, is here:\ <a href="http://northernwidget.github.io/ALog/classALog.html">http://northernwidget.github.io/ALog/classALog.html</a></p>
<p>See the thermistor example (below) and the information in the "Basic
Reference" (above) for a more in-depth description of how to create and use sensor functions.</p>
<h3>Thermistor example</h3>
<p>Thus far, we have explored many different aspects of the <a class="el" href="classALog.html">ALog</a> bottle logger. Now, let's bring many of these together in an example of source code for the <a class="el" href="classALog.html">ALog</a>. In this example, we will measure a temperature-sensitive resistor, or "thermistor", using the analog measurement capabilities of the <a class="el" href="classALog.html">ALog</a>. This is one of the most basic measurements that one can make with the <a class="el" href="classALog.html">ALog</a>, but also one of the most important and most commonly employed.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ALog_8h.html">ALog.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="classALog.html">ALog</a> alog;</div><div class="line"></div><div class="line"><span class="comment">// Note: Serial baud rate is set to 38400 bps</span></div><div class="line"></div><div class="line"><span class="comment">// USER-ENTERED VARIABLES //</span></div><div class="line"><span class="comment"></span><span class="keywordtype">char</span>* dataLoggerName = <span class="stringliteral">&quot;Thermistor Logger&quot;</span>; <span class="comment">// Name of logger; displayed in Serial communications</span></div><div class="line"><span class="keywordtype">char</span>* fileName = <span class="stringliteral">&quot;TempLog1.txt&quot;</span>; <span class="comment">// Name of file for logged data: 8.3 format (e.g,</span></div><div class="line">                            <span class="comment">// ABCDEFGH.TXT); &lt;= 8 chars before &quot;.txt&quot; is OK</span></div><div class="line"></div><div class="line"><span class="comment">//Setup logging interval here, may set up more than one variable.</span></div><div class="line"><span class="comment">//Minimum interval = 1 sec, maximum interval is 23 hours, 59 minutes, 59 seconds</span></div><div class="line"><span class="comment">//0 for all means that the logger will not sleep</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Seconds = 10; <span class="comment">//Valid range is 0-59 seconds</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Minutes = 0; <span class="comment">//Valid range is 0-59 minutes</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Hours = 0; <span class="comment">//Valid range is 0-23 hours</span></div><div class="line"><span class="comment">// external_interrupt is true for a tipping bucket rain gauge</span></div><div class="line"><span class="keywordtype">bool</span> external_interrupt = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup(){</div><div class="line">  alog.<a class="code" href="classALog.html#a39a065992ef2c51a992ddc0fe0f0c0e4">initialize</a>(dataLoggerName, fileName,</div><div class="line">    Log_Interval_Hours, Log_Interval_Minutes, Log_Interval_Seconds,</div><div class="line">    external_interrupt);</div><div class="line"></div><div class="line">  <span class="comment">// If you are using a standard Arduino board (i.e. not a full ALog data</span></div><div class="line">  <span class="comment">// logger) and are not using the Arduino shield, you will have to set the</span></div><div class="line">  <span class="comment">// proper pins for the indicator LED (defaults to 9) and the SD card, RTC</span></div><div class="line">  <span class="comment">// power, and sensor or other external device power (default to -1).</span></div><div class="line">  <span class="comment">// The &quot;-1&quot; default ensures that no pins are affected by commands to switch</span></div><div class="line">  <span class="comment">// power to the SD card, RTC power, or sensor power. This is because the</span></div><div class="line">  <span class="comment">// typical use case, a standard Arduino Uno, uses the Arduino&#39;s built-in</span></div><div class="line">  <span class="comment">// 3V3 regulator to power to run the RTC and SD card (as we do with the ALog</span></div><div class="line">  <span class="comment">// shield).</span></div><div class="line">  <span class="comment">// These can also be set to the same value if they are needed but the same</span></div><div class="line">  <span class="comment">// voltage regulator serves multiple purposes.</span></div><div class="line">  <span class="comment">// Replace &quot;_pin&quot; with your desired pin number, and uncomment the relevant</span></div><div class="line">  <span class="comment">// following line(s).</span></div><div class="line">  <span class="comment">// set_LEDpin(_pin);</span></div><div class="line">  <span class="comment">// set_SDpowerPin(_pin);</span></div><div class="line">  <span class="comment">// set_RTCpowerPin(_pin);</span></div><div class="line">  <span class="comment">// set_SensorPowerPin(_pin);</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#a6cb64bdadb4df047d14632614ffaac13">setupLogger</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> loop(){</div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#ab84c0dd0f4de44aa1232a86b8006ae8c">goToSleep_if_needed</a>(); <span class="comment">// Send logger to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#aa8a242bb8886969dacd615e47bbd4537">startLogging</a>(); <span class="comment">// Power up all systems, check WDT, reset alarms,</span></div><div class="line">                       <span class="comment">// and open data file(s) in write mode</span></div><div class="line"></div><div class="line">  <span class="comment">// ************ DO NOT EDIT ABOVE THIS LINE ************</span></div><div class="line"></div><div class="line">  <span class="comment">// READ SENSORS; GATHER/PROCESS DATA: EDIT THIS PART //</span></div><div class="line"><span class="comment"></span></div><div class="line">  alog.<a class="code" href="classALog.html#a4caaaa0172dc3ef82dba5934ae1c5f6d">sensorPowerOn</a>();</div><div class="line"></div><div class="line">  <span class="comment">// Turn on external power (3.3V and 5V in the case of the ALog BottleLogger)</span></div><div class="line">  <span class="comment">// for sensors and any other devices.</span></div><div class="line">  <span class="comment">// Place commands for all sensors that require this between</span></div><div class="line">  <span class="comment">// SensorPowerOn() and SensorPowerOff().</span></div><div class="line">  <span class="comment">// If you have no sensors that require power, you should comment out the</span></div><div class="line">  <span class="comment">// SensorPowerOn() and SensorPowerOff() commands.</span></div><div class="line"></div><div class="line">  <span class="comment">// CanTherm small bead</span></div><div class="line">  <span class="comment">//logger.thermistorB(10000, 3950, 10000, 25, 0);</span></div><div class="line">  <span class="comment">// CanTherm epoxy bead: CWF1B103F3380</span></div><div class="line">  logger.thermistorB(10000, 3380, 10000, 25, 0);</div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#ae6b39bc05a8e82c44ee1588bc0cd50dc">sensorPowerOff</a>();</div><div class="line"></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line">  <span class="comment">// INSERT COMMANDS TO READ SENSORS THAT DO NOT REQUIRE ALOG-SUPPLIED POWER HERE! //</span></div><div class="line">  <span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// NOTE: THE BUFFER SIZE IS 512 BYTES;</span></div><div class="line">  <span class="comment">// run &quot;alog.bufferWrite()&quot; between your commands in this section</span></div><div class="line">  <span class="comment">// if you think you are approaching this limit.</span></div><div class="line">  <span class="comment">// Otherwise, the buffer will overflow and I&#39;m not sure what will happen!</span></div><div class="line">  <span class="comment">// alog.bufferWrite()</span></div><div class="line"></div><div class="line">  <span class="comment">// ************ DO NOT EDIT BELOW THIS LINE ************</span></div><div class="line"></div><div class="line">  <span class="comment">// Wrap up files, turn off SD card, and go back to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#a3919a4ae72a0b6ac7dea25a5a1e8a6d0">endLogging</a>();</div><div class="line"></div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line">}</div></div><!-- fragment --><p>It's time to break this down into its component steps:</p>
<h4></h4>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ALog_8h.html">ALog.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="classALog.html">ALog</a> alog;</div></div><!-- fragment --><p>The <code>#include</code> call tells the sketch to use the <a class="el" href="classALog.html">ALog</a> library.</p>
<p>The second line of source code creates an instance of the <a class="el" href="classALog.html">ALog</a> object, called "alog". We will use "alog" as our portal into all of the tools that the <a class="el" href="classALog.html">ALog</a> library offers. </p><pre class="fragment">// Note: Serial baud rate is set to 38400 bps
</pre><p>Self-explanatory!</p>
<div class="fragment"><div class="line"><span class="comment">// USER-ENTERED VARIABLES //</span></div><div class="line"><span class="comment"></span><span class="keywordtype">char</span>* dataLoggerName = <span class="stringliteral">&quot;Thermistor Logger&quot;</span>; <span class="comment">// Name of logger; displayed in Serial communications</span></div><div class="line"><span class="keywordtype">char</span>* fileName = <span class="stringliteral">&quot;TempLog1.txt&quot;</span>; <span class="comment">// Name of file for logged data: 8.3 format (e.g,</span></div><div class="line">                            <span class="comment">// ABCDEFGH.TXT); &lt;= 8 chars before &quot;.txt&quot; is OK</span></div><div class="line"></div><div class="line"><span class="comment">//Setup logging interval here, may set up more than one variable.</span></div><div class="line"><span class="comment">//Minimum interval = 1 sec, maximum interval is 23 hours, 59 minutes, 59 seconds</span></div><div class="line"><span class="comment">//0 for all means that the logger will not sleep</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Seconds = 10; <span class="comment">//Valid range is 0-59 seconds</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Minutes = 0; <span class="comment">//Valid range is 0-59 minutes</span></div><div class="line"><span class="keywordtype">int</span> Log_Interval_Hours = 0; <span class="comment">//Valid range is 0-23 hours</span></div><div class="line"><span class="comment">// external_interrupt is true for a tipping bucket rain gauge</span></div><div class="line"><span class="keywordtype">bool</span> external_interrupt = <span class="keyword">false</span>;</div></div><!-- fragment --><p><code>dataLoggerName</code> is an identifier for the logger. I typically make it relate to the field site, the task of the logger, and a code number.</p>
<p><code>fileName</code> is the name of the main data file to be logged to the SD card. (See SD card section, above, for information on all of the files that may be written to the SD card.) This is noted to be in 8.3 format, but doesn't strictly have to be following updates to the <code>SdFat</code> library.</p>
<p><code>Log_Interval_Seconds</code>, <code>Log_Interval_Minutes</code>, and <code>Log_Interval_Hours</code> all determine how often the logger will record data. Data recording is set to always occur on hours/minutes/seconds that are synchronous across all devices and are set to be referenced as much as possible to a the start of an hour/day/minute (more details in source code).</p>
<p><code>external_interrupt</code> is true if a device that triggers an instant response is attached, and false if it is not. As noted, this is most commonly a tipping-bucket rain gauge, but it could really be any sensor. The appropriate sensor functions will define the response to the interrupt; the simplest case (rain gauge) is that a time-stamp is recorded to a specific file.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup(){</div><div class="line">  alog.<a class="code" href="classALog.html#a39a065992ef2c51a992ddc0fe0f0c0e4">initialize</a>(dataLoggerName, fileName,</div><div class="line">    Log_Interval_Hours, Log_Interval_Minutes, Log_Interval_Seconds,</div><div class="line">    external_interrupt);</div></div><!-- fragment --><p>This is the start of the <code>setup()</code> step, which is run once when the logger turns on. Here, the variables from the previous section are passed to the "alog" object instance, which then creates the appropriate variables and their derivatives within the object. This initializes the object and prepares it for logging.</p>
<div class="fragment"><div class="line"><span class="comment">// If you are using a standard Arduino board (i.e. not a full ALog data logger)</span></div><div class="line"><span class="comment">// and are not using the Arduino shield, you will have to set the proper pins for</span></div><div class="line"><span class="comment">// the indicator LED (defaults to 9) and the SD card and RTC power (default to -1</span></div><div class="line"><span class="comment">// if you are not programming an ALog data logger in order</span></div><div class="line"><span class="comment">// to be inactive in the case that you are using the Arduino&#39;s 3V3 regulator to</span></div><div class="line"><span class="comment">// power to run the RTC and SD card (as we do with the ALog shield); set these to the same</span></div><div class="line"><span class="comment">// value if there is just one switch for both of these).</span></div><div class="line"><span class="comment">// Replace &quot;_pin&quot; with your desired pin number, and uncomment the relevant line(s).</span></div><div class="line"><span class="comment">// set_LEDpin(_pin);</span></div><div class="line"><span class="comment">// set_SDpowerPin(_pin);</span></div><div class="line"><span class="comment">// set_RTCpowerPin(_pin);</span></div></div><!-- fragment --><p>As is written in the comments, set these values for the indicator LED, SDpowerPin, and RTCpowerPin. The latter two are typically unset on non-ALog Arduino boards, and are equal to each other (but already set within the <a class="el" href="classALog.html">ALog</a> library) for <a class="el" href="classALog.html">ALog</a> boards.</p>
<div class="fragment"><div class="line">  alog.<a class="code" href="classALog.html#a6cb64bdadb4df047d14632614ffaac13">setupLogger</a>();</div><div class="line">}</div></div><!-- fragment --><p>At this point, the logger has all the information it needs from you, and completes its internal setup.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loop(){</div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line"></div><div class="line">  alog.<a class="code" href="classALog.html#ab84c0dd0f4de44aa1232a86b8006ae8c">goToSleep_if_needed</a>(); <span class="comment">// Send logger to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#aa8a242bb8886969dacd615e47bbd4537">startLogging</a>(); <span class="comment">// Power up all systems, check WDT, reset alarms,</span></div><div class="line">                       <span class="comment">// and open data file(s) in write mode</span></div><div class="line"></div><div class="line">  <span class="comment">// ************ DO NOT EDIT ABOVE THIS LINE ************</span></div></div><!-- fragment --><p>This is the start of the loop, which repeats infinitely unless the <a class="el" href="classALog.html">ALog</a> data logger is shut off or fails.</p>
<p>Here, the comments are self-explanatory, mostly; a couple extra explanations:</p>
<ul>
<li>"Sleep" is a low-power mode; it will exit this (and complete this function) when triggered by the clock, a press of the "LOG" button, or an user-defined external interrupt.</li>
<li>WDT = watchdog timer; this causes the logger to reboot if it hangs for &gt;8 seconds, and therefore allows it to recover from failures.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// READ SENSORS; GATHER/PROCESS DATA: EDIT THIS PART //</span></div><div class="line"><span class="comment"></span></div><div class="line">alog.<a class="code" href="classALog.html#a4caaaa0172dc3ef82dba5934ae1c5f6d">sensorPowerOn</a>();</div><div class="line"></div><div class="line"><span class="comment">// Turn on external power (3.3V and 5V in the case of the ALog BottleLogger)</span></div><div class="line"><span class="comment">// for sensors and any other devices.</span></div><div class="line"><span class="comment">// Place commands for all sensors that require this between</span></div><div class="line"><span class="comment">// SensorPowerOn() and SensorPowerOff().</span></div><div class="line"><span class="comment">// If you have no sensors that require power, you should comment out the</span></div><div class="line"><span class="comment">// SensorPowerOn() and SensorPowerOff() commands.</span></div><div class="line"></div><div class="line"><span class="comment">// CanTherm small bead</span></div><div class="line"><span class="comment">//logger.thermistorB(10000, 3950, 10000, 25, 0);</span></div><div class="line"><span class="comment">// CanTherm epoxy bead: CWF1B103F3380</span></div><div class="line">logger.thermistorB(10000, 3380, 10000, 25, 0);</div><div class="line"></div><div class="line">alog.<a class="code" href="classALog.html#ae6b39bc05a8e82c44ee1588bc0cd50dc">sensorPowerOff</a>();</div></div><!-- fragment --><p>This is it, where the magic happens!</p>
<p><code>alog.sensorPowerOn()</code> and <code>alog.sensorPowerOff()</code> turn the voltage regulators that power external sensors on and off, respectively &ndash; just like it says in the comments!</p>
<p><code>logger.thermistorB(...)</code> is the command. The parameters passed, in order, are:</p>
<ul>
<li>Factory standard resistance of thermistor [ohms]</li>
<li>Factory standard b-value (or beta-value) of thermistor [ohms]</li>
<li>Reference resistor resistance [ohms]</li>
<li>Standard temperature to which factory standard resistance corresponds [ohms]</li>
<li>Analog pin number (this could equally be A1 or 14 for the <a class="el" href="classALog.html">ALog</a> BottleLogger)</li>
</ul>
<p>Do you want to know more about these parameters? Look up the function-specific help, which is below if you are looking at the PDF version of the help (downloadable from <a href="http://northernwidget.github.io/ALog/ALogReferenceManual.pdf">http://northernwidget.github.io/ALog/ALogReferenceManual.pdf</a>) and available online at <a href="http://northernwidget.github.io/ALog/classALog.html">http://northernwidget.github.io/ALog/classALog.html</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div><div class="line"><span class="comment">// INSERT COMMANDS TO READ SENSORS THAT DO NOT REQUIRE ALOG-SUPPLIED POWER HERE! //</span></div><div class="line"><span class="comment">// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! //</span></div></div><!-- fragment --><p>We don't have any of these here, but examples would be sensors with their own power-supplies, and/or (not consistent with the comment above) sensors that are powered directly via the <a class="el" href="classALog.html">ALog</a> BottleLogger's VCC. This is not included in the comment because it is generally not how we run sensors &ndash; we like to be able to switch them off to conserve power!</p>
<div class="fragment"><div class="line"><span class="comment">// NOTE: THE BUFFER SIZE IS 512 BYTES;</span></div><div class="line"><span class="comment">// run &quot;alog.bufferWrite()&quot; between your commands in this section</span></div><div class="line"><span class="comment">// if you think you are approaching this limit.</span></div><div class="line"><span class="comment">// Otherwise, the buffer will overflow and I&#39;m not sure what will happen!</span></div><div class="line"><span class="comment">// alog.bufferWrite()</span></div></div><!-- fragment --><p>As it says: if you think you're in danger of overflowing the buffer, run this command! You'll need 512 characters in your line for this to happen though, and I've never approached this in my work. But hey, someone might!</p>
<div class="fragment"><div class="line">  <span class="comment">// ************ DO NOT EDIT BELOW THIS LINE ************</span></div><div class="line"></div><div class="line">  <span class="comment">// Wrap up files, turn off SD card, and go back to sleep</span></div><div class="line">  alog.<a class="code" href="classALog.html#a3919a4ae72a0b6ac7dea25a5a1e8a6d0">endLogging</a>();</div><div class="line"></div><div class="line">  <span class="comment">// *****************************************************</span></div><div class="line">}</div></div><!-- fragment --><p>As it says, the <code>alog.endLogging()</code> command finalizes everything before sending the logger back to sleep. And that's really all there is to it! Your first <a class="el" href="classALog.html">ALog</a> Arduino sketch in a nutshell.</p>
<p>And as always, if anything here is unclear, please contact us and we'll try our best to fix it &ndash; specific advice appreciated!</p>
<h2>Setting the real-time clock </h2>
<h3>Graphical interface</h3>
<p>Coming soon!</p>
<h3>Command-line</h3>
<p>The <a class="el" href="classALog.html">ALog</a>'s clock is a key component &ndash; without it, all the data are sitting in an unreferenced time frame. This is why we have chosen the DS3231 real-time clock, which has the highest accuracy and stability of any commonly-available real-time clock that does not incorporate an absolute time reference (e.g., with GPS). GPS would be great for some circumstances, and we're developing a logger with it, but this would not be the extreme low-power device that the <a class="el" href="classALog.html">ALog</a> BottleLogger is.</p>
<p>Enough with the background &ndash; how do you set the clock?</p>
<p>You will need the <b><a class="el" href="classALog.html">ALog</a> library</b> and the <b>DS3231 library</b>, both of which you should already have at this point, as well as the <b>ALogTalk</b> repository of Python scripts at <a href="github.com/NorthernWidget/ALogTalk">github.com/NorthernWidget/ALogTalk</a>. In order to run the Python scripts, you need either <b>Python 2</b> (including <b>pyserial</b>) or for us to have made an executable version for your platform.</p>
<h4>Integrated into the <a class="el" href="classALog.html">ALog</a> code</h4>
<p>When you upload the <a class="el" href="classALog.html">ALog</a> code to your <a class="el" href="classALog.html">ALog</a> data logger or Arduino board, it includes code to set the clock via serial communications. Plug in your data logger, run <b>ALogClockSet.py</b> (which is in the <b>ALogTalk</b> repository), and it should work &ndash; if it doesn't, hit the reset button.</p>
<p>How do you run <b>ALogClockSet.py</b>?</p>
<p><b>All operating systems:</b> Open a terminal, navigate to the directory that holds <b>ALogClockSet.py</b> (the directory should be called <b>ALogTalk</b>, and type: </p><pre class="fragment">python ALogClockSet.py
</pre><p>Don't have Python? You probably will have figured it out when that failed Here are your options:</p>
<ol type="1">
<li>Install Python 2.X; I recommend getting the <b>anaconda</b> distribution</li>
<li>Download an executable version of <b>ALogClockSet.py</b>; email us if you can't find this (it's not always up-to-date due to the overhead required for making executables)</li>
</ol>
<h4>After uploading a separate sketch</h4>
<p>Open the "ALog\_DS3231\_set\_echo" example (<b>File (Arduino on Mac)</b> &gt; <b>Examples</b> &gt; <b>DS3231</b> &gt; <b>ALog_DS3231_set_echo</b>) and upload it to the board.</p>
<p>Open a terminal, navigate to the <b>ALogTalk</b> directory, and type: </p><pre class="fragment">python SimpleClockSet.py
</pre><h2>Connecting sensors (and more) to the <a class="el" href="classALog.html">ALog</a> </h2>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ALogUsersLayout.png" alt="User&apos;s layout and connection
guide" title="User&apos;s layout and connection guide"/>
</div>
<p>\ <p><em><b>User's layout and connection guide</b></em></p>
<p><a href="https://github.com/NorthernWidget/ALog/raw/master/doc/ALogUsersLayout_smallfile.pdf">[PDF of User's Layout guide]</a>\ <a href="http://northernwidget.com/wp-content/uploads/2017/05/ALogUsersLayout_smallfile.pdf">(backup link)</a></p>
<h3>Pin definitions</h3>
<p>This list includes only those pins on the <a class="el" href="classALog.html">ALog</a> BottleLogger with which the user can connect.</p>
<p>Pin number (Arduino) Label on <a class="el" href="classALog.html">ALog</a> BottleLogger Capabilities </p><hr/>
<p> 0 Rx UART Rx* 1 Tx UART Tx* 3 D3/INT1 External interrupt; digital I/O 6 D6 PWM**; digital I/O 9 D9 PWM**; digital I/O 11 MOSI SPI MOSI 12 MISO SPI MISO 13 SCK SPI SCK A0 (14) A0 Analog input (10-bit); digital I/O A1 (15) A1 Analog input (10-bit); digital I/O A2 (16) A2 Analog input (10-bit); digital I/O A3 (17) A3 Analog input (10-bit); digital I/O A4 (18) / SDA SDA I2C SDA A5 (19) / SCL SCL I2C SCL A6 (20) A6 Analog input (10-bit); digital I/O A7 (21) A7 Analog input (10-bit); digital I/O</p>
<p>*The UART is connected to the USB-Serial converter; using it with sensors is possible, but requires caution when designing new UART sensor interfaces to avoid interference with communications with the computer.</p>
<p>**PWM = "Pulse-width modulation"</p>
<p>This table does not include pin capabilities that are technically possible but not recommended. These include:</p>
<ul>
<li>Rx and Tx pins (UART), SPI pins, and I2C pins can all be used as standard digital I/O pins; this would cause problems communicating with the computer, communicating with the SD card (and sensors), and communicating with the clock (and sensors), respectively.</li>
<li>I2C pins (A4 and A5) are not recommended to be used as analog input pins, though technically they are; this will cause problems with communication with the real-time clock and any other I2C device</li>
</ul>
<h3>Additional <a class="el" href="classALog.html">ALog</a> ports</h3>
<p>Label on <a class="el" href="classALog.html">ALog</a> BottleLogger Connected to... </p><hr/>
<p> GND Ground (Earth / 0V / battery negative (-) terminal) 3V3 3.3V ±1% precision low-dropout voltage regulator 5V 5V charge pump; 5V is nominal: for tiny loads, it can go up to 5.2V VCC "Voltage of the common connector" (Power / battery (+) terminal)</p>
<h3>How to attach wires to screw terminals</h3>
<p>Tools/materials needed:</p>
<ul>
<li>Screwdriver, slotted. We recommend a 0.4 x 2 mm blade. Good options are <a href="https://www.digikey.com/product-detail/en/wiha/26020/431-1176-ND/510465">this one</a> and its <a href="https://www.digikey.com/product-detail/en/wiha/27220/431-1202-ND/512198">ESD-safe version</a>.</li>
<li><a class="el" href="classALog.html">ALog</a> data logger or equivalent</li>
<li>A sensor!</li>
</ul>
<p>Also helpful:</p>
<ul>
<li>Common sense</li>
<li>Caution</li>
</ul>
<p>To be safe, disconnect power from the logger before attaching or detaching any wires. For full disclosure, though, we do this with power attached all the time &ndash; this just opens the possibility of something going wrong, and requires steady hands.</p>
<p>Using the screwdriver, open the screw terminal (lefty loosey), stick the end of the wire into it, and then close the screw terminal until you feel significant resistance (righty tighty!). The goal is that the wire can't come out under reasonable force.</p>
<p>![Attaching a wire (photo R. Schulz)](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/AttachWireScrew.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/AttachWireScrew.png</a> "Attaching a wire (photo R. Schulz)")\  <h3>Reference resistors (what are they good for?)</h3>
<p>Two parallel rows of headers are designed to hold through-hole resistors that span one row to the other. Each of these is numbered to correspond to a particular analog port. Why are these here?</p>
<p>The analog channels on the <a class="el" href="classALog.html">ALog</a> (or any electronic device) read voltage. But a lot of sensors return resistance. So how do we change that resistance into a voltage?</p>
<p>The key is a little bit of circuit algebra for something called the "Voltage divider":</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/Resistive_divider2.png" alt="Voltage
divider" title="Voltage divider"/>
</div>
<p>\ <p>For the <a class="el" href="classALog.html">ALog</a>, the sensor typically lies between 3V3 (a power source, Vin on the above diagram) and an analog pin (Vout on the above diagram). Applying Ohm's law gives you the following equation that one can use to solve for the value of R1 if you know R2.</p>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/VdivEquation.png" alt="Voltage
divider" title="Voltage divider"/>
</div>
<p>\ <p>And this is where the reference resistor comes in: this is the R2, connected between Vout and GND.</p>
<p>It is possible, and necessary with a few sensors, to flip the structure around; in this case, a reference resistor is not attached to the header on the board, but is instead attached to the screw terminals for a power source and the appropriate analog port. Such a reversed order may require a flag to be set in the code.</p>
<p>And that's it: <b>the reference resistor is a standard</b> required to measure another unknown resistance, and it is implemented in a circuit that converts the unknown resistance into a voltage.</p>
<p><em>For more information, see <a href="https://en.wikipedia.org/wiki/Voltage_divider#Resistive_divider">Wikipedia: Voltage divider</a></em></p>
<h3>The ISP (or ICSP) header and the bootloader</h3>
<p>This is the last section in the connection guide because it is the one that &ndash; hopefully &ndash; you will never have to use!</p>
<p>Place your <a class="el" href="classALog.html">ALog</a> BottleLogger in front of you with the SD card to the right. Look at the upper left corner. Do you see those six holes? Those are the ones that we are talking about. They allow the user to burn programs directly onto the logger. <b>This is called the "In-System
Programmer" or "ISP" header.</b></p>
<p>*(If you are using a standard Arduino, there should be an ISP header as well; if you are using an ARM-based chip, there is a bigger header with smaller pin spacings.)*</p>
<p>When your <a class="el" href="classALog.html">ALog</a> (or Arduino) arrives, it has a bootloader on it &ndash; a small program that allows you to upload code via the USB connection. Useful! But if somehow something happens to the bootloader, you will have to burn a new one. You will need an in-system programmer: AVR ISP, another Arduino, the Adafruit USBtinyISP, etc... there are many possibilities! If you have an ARM-based chip, you will need an ATmel AVR Dragon or other more advanced programming chip.</p>
<p>Then, remove the SD card. The ISP on any standard Arduino uses the SPI interface. The SD card, which also uses the SPI interface, may interfere with bootloader burning.</p>
<p>After this, go to the <b>Tools</b> menu. Make sure that you have selected the proper board (<b>Tools</b> &gt; <b>Board</b>) and programmer (<b>Tools</b> &gt; <b>Programmer: "\[NAME OF YOUR CURRENTLY-SELECTED PROGRAMMER\]"</b>). Then plug the ISP of your choice into the ISP header: simply holding a 6-pin header at an angle in the holes so the metal makes contact is enough for the <a class="el" href="classALog.html">ALog</a> BottleLogger, but you may solder it if you choose. Once you have a good connection, go to <b>Tools</b> &gt; <b>Burn Bootloader</b> and wait for the programmer to tell you that it has successfully completed the task.</p>
<p>If it doesn't work, the most common reason is because you have inserted the ISP backwards. Flip the ISP header around and try again.</p>
<h2>Field deployment </h2>
<h3>SD card</h3>
<p>Insert the SD card carefully, and make sure that it is seated! The logger will reset constantly if it is not and it is v2.2.0+. Otherwise, it is important to hit the "RESET" button and make sure that the LOOOOONG-short-short flash pattern occurs. This means that the logger is ready to go. Otherwise, no data will be recorded!</p>
<p>![Inserting SD card (photo R. Schulz)](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/InsertSD.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/InsertSD.png</a> "Inserting SD card (photo R. Schulz)")\  <h3>Power</h3>
<h4>Barrel jack</h4>
<p>In the field, the main way to power the <a class="el" href="classALog.html">ALog</a> data logger is by plugging in a barrel jack connected to a battery pack. We typically use barrel jacks with screw terminals to attach to generic battery packs (D or AA) that have wire leads; we sometimes use barrel jacks that are already part of the cable.</p>
<p>![Plugging in the barrel jack (photo R. Schulz)](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/BarrelJack.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/BarrelJack.png</a> "Plugging in the barrel jack (photo R. Schulz)")\  <h4>JST connector</h4>
<p>Next to the barrel jack is a solder pad for a JST connector. This may be populated (i.e., you may solder a JST connector to the board here) if needed to attach power supplies.</p>
<h4>Power sources</h4>
<p>We typically use 3xD or 3xAA primary cell batteries, as they are light, inexpensive, reliable, and available around the world.</p>
<p>Solar charging system development is ongoing, and once complete, will allow long-term power supply and a higher rate of logger power consumption.</p>
<h3>Housing and waterproofing</h3>
<p>![Housing, logger, AA battery box, and cable gland (photo R. Schulz)](<a href="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/HousingSmall.png">https://github.com/NorthernWidget/ALog/raw/master/doc/figures/HousingSmall.png</a> "Housing, logger, AA battery box, and cable gland (photo R. Schulz)")\  <a class="el" href="classALog.html">ALog</a> in a box. Note that here, the <a class="el" href="classALog.html">ALog</a> is powered through its VCC and GND screw terminals; this demonstrates a non-standard but acceptable way of supplying power to the logger, and one that works well in a small enclosure like this one.</p>
<h4>Housing details</h4>
<ul>
<li>Manufacturer: Bud Industries</li>
<li>Ratings: IP66, NEMA 1, 2, 4, 4X, 12, 13</li>
<li>Description: Grey ABS plastic with a hinged door lid. Mounting hardware included.</li>
<li>Preferred sizes:<ul>
<li>Small (pictured above): Max exterior dimensions 150mm H X 100mm W X 70mm H, Wall thickness 3mm, Weight: 318g</li>
<li>Large: Max exterior dimensions 270mm H X 100mm W X 70mm H, Wall thickness 3mm, Weight: 363g</li>
</ul>
</li>
<li>Metal "feet" can swiveled and work with U-bolts, hose clamps, screws, cable ties, etc.</li>
</ul>
<h4>Battery pack</h4>
<ul>
<li>Box with lid, connected to housing with hook-and-loop.</li>
</ul>
<h4><a class="el" href="classALog.html">ALog</a></h4>
<ul>
<li>Fixed in place with hook-and-loop.</li>
</ul>
<h4>Cable gland</h4>
<ul>
<li>Nylon cable gland: NBR hermetic seal. Protection degree: IP68, 5 Bar, IP69K, UL f1. Working temperature: -40°C to 100°C in static state Instantaneous heat resistance up to 120°C -20°C to 80°C in dynamic state. cable diameter range 0.11-0.26"</li>
</ul>
<h4>Vent (if needed)</h4>
<ul>
<li>GORE VE80510 adhesive vent for pressure equalization. Vent offers reliable protection against water, salts, corrosive liquids and particulate with hydrophobic and oleophobic characteristics. This vent is made of GORE-TEX fabric to keep water out while permitting the passage of air.</li>
</ul>
<h3>Deployment</h3>
<p>The last step is deployment! You have to think about how you will mount the logger box:</p>
<ul>
<li>Bury it?</li>
<li>Attach it to a post?</li>
<li>Place it on the ground?</li>
</ul>
<div class="image">
<img src="https://github.com/NorthernWidget/ALog/raw/master/doc/figures/ChimborazoGS3.png" alt="Field deployment on
Chimborazo" title="Field deployment on Chimborazo"/>
</div>
<p>\  It also is important to consider how you will attach it: do you need:</p>
<ul>
<li>Zip-ties</li>
<li>Hose clamps</li>
<li>U-bolts</li>
<li>Electrical tape</li>
<li>Bailing wire</li>
<li>Fence posts (and fence post driver?)</li>
<li>Desiccant packets</li>
<li>Tools</li>
<li>Specific tools for your installation?</li>
</ul>
<p>There are so many ways to mount the loggers in the field that we can't cover all usage scenarios. But here are some important points:</p>
<ol type="1">
<li>It is really important to think through your deployment! Use common sense, test locally, and ask for advice!</li>
<li>Label the SD card, box, and the logger with an identifying code or name for the station.</li>
<li>Ensure that your code that you have uploaded includes a unique filename and logger name.</li>
<li>If you have cable glands, point them down if at all possible to prevent water from entering.</li>
<li>Desiccant packs are your friends; make sure that you don't use the kind that fail catastrophically upon reaching 100% moisture content by turning into a liquid! (We had this happen in Ecuador...)</li>
<li>Assess the greatest challenges. If weather, place your logger in a safe place (typically high and dry). If humans, hide it. (Bury it, even! But take a good GPS location and make note of landmarks.)</li>
<li>Record the logger's name, its sensors, its serial number, and its GPS coordinates.</li>
<li>Small rodents love chewing cables for reasons that are their own (but might have something to do with the taste of the insulation). Bury cables, keep them high, and/or surround them with conduit. (I've seen plastic conduit chewed through once as well...)</li>
<li>The last thing before you leave an <a class="el" href="classALog.html">ALog</a> installation should always be to push the "RESET" button and ensure that you see "LOOOONG short
    short" from the red LED (and only "LOOOONG short short")!</li>
</ol>
<p><b>So long, and good luck!</b> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
